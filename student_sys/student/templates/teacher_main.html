<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>教师工作主页</title>
    <script src="/static/axios.min.js"></script>
    <script src="../static/layui/layui.all.js"></script>
    <link rel="stylesheet", href="../static/layui/css/layui.css">
    <link rel="stylesheet" href="/static/cssFiles/teacher.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1> 上海对外经贸大学第二课堂成绩系统 </h1>
            <span id="menu">
                <p> 欢迎您, <strong>{{ request.user }}</strong>! </p>
                <a href="/logout" style="font-size: 12; font-color: yellow">退出登录</a>
            <span>
        </div>
        
        {% comment %} <div class="sider">
            <ul class="layui-nav layui-nav-tree" lay-filter="test">
                <li class="layui-nav-item layui-nav-itemed">
                    <a href="javascript:;">工作台</a>
                </li>
                <li class="layui-nav-item">
                    <a href="">信息查询</a>
                </li>
            </ul>
        </div> {% endcomment %}

        <div class="main">
            <div class="layui-tab layui-tab-card">
                <ul class="layui-tab-title">
                    <li class="layui-this">待认证记录</li>
                    <li>信息查询</li>
                </ul>
                <div class="layui-tab-content">
                    <div class="layui-tab-item layui-show">
                        {% comment %} 此处为各学院的待认证组织经历和奖励经历列表 {% endcomment %}
                        
                    </div>
                    <div class="layui-tab-item">
                        <div class="search">
                            <form class="layui-form" id="myForm" method="post" action="/downloadDocx">
                                <div class="layui-item">
                                    <input class="layui-input-inline" type="text" name="_id" id="_id" 
                                        required lay-verify="required" placeholder="请输入学号" onfocus="clearAlarm()"/>
                                </div>
                            </form>
                            <div class="layui-item">
                                <button class="layui-btn layui-btn-primary layui-btn-sm" onclick="submitDATA()">查看</button>
                            </div>
                        </div>
                        <div class="display_info" id="res_info"></div>
                        <span class="display_info" id="buttons" style="display:none">
                            {% comment %} <button class="layui-btn layui-btn-sm" onclick="printMe()">打印</button> {% endcomment %}
                            <button class="layui-btn" onclick="formSubmit()">导出</button>
                        </span>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    var clearAlarm = function () {
        var mask_tags = document.getElementsByClassName("display_info")
        for (let mt of mask_tags) {
            mt.style.display = "none";
        }
    }

    var formSubmit = function () {
        document.getElementById("myForm").submit()
    }

    var submitDATA = function () {
        let student_id = document.getElementById("_id").value
        console.log(student_id)
        if (student_id) {
            axios.post("/checkDocx", {s_id: student_id})
                .then(function(res){
                    document.getElementsByClassName("main")[0].style.display = "block";
                    var resData = res.data;
                    var res_info = document.getElementById("res_info");
                    var buttons = document.getElementById("buttons");

                    res_info.style.display = "inline";
                    res_info.innerHTML = resData;
                    if (resData.indexOf("<table") >= 0){ // 如果查询到结果
                        buttons.style.display = "inline";
                    }
                })
                .catch(function(err){
                    console.log(err);
                })
        } else {
            console.log("帐号为空!")
        }
    }

    var printMe = function (){
        var oldBody = document.body.innerHTML;
        document.body.innerHTML = "<h2>上海对外经贸大学学生第二课堂经历证明</h2>" + document.getElementById('res_info').innerHTML;
        window.print();
        document.body.innerHTML = oldBody // 恢复
    }
</script>
<script>
    layui.use('element', function(){
        var element = layui.element;
    });
</script>
</html>

 {% comment %} onclick="submitDATA()" {% endcomment %}