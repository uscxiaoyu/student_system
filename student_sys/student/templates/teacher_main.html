<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>教师工作主页</title>
    <script src="/static/axios.min.js"></script>
    <script src="../static/layui/layui.all.js"></script>
    <link rel="stylesheet", href="../static/layui/css/layui.css">
    <link rel="stylesheet" href="/static/cssFiles/teacher.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1> 上海对外经贸大学第二课堂成绩系统 </h1>
            <span id="menu">
                <p> 欢迎您, <strong>{{ request.user }}</strong>! </p>
                <a href="/logout" style="font-size: 12; font-color: yellow">退出登录</a>
            <span>
        </div>
        
        <div class="sider">
            <div class="search">
                <form class="layui-form" id="myForm" method="post" action="/downloadDocx">
                    <div class="layui-itme">
                        <input class="layui-input-inline" type="text" name="_id" id="_id" 
                            required lay-verify="required" placeholder="请输入学号" onfocus="clearAlarm()"/><br>
                    </div>
                </form>
                <span>
                    <button class="layui-btn layui-btn-sm" onclick="submitDATA()">查看</button>
                </span>
            </div>
            <div class="file_upload">

            </div>
        </div>

        <div class="main display_info" style="display:none">
            <span id="buttons">
                    <button class="layui-btn layui-btn-sm" onclick="printMe()">打印</button>
                    <button class="layui-btn layui-btn-sm" onclick="formSubmit()">导出</button>
            </span>
            <div id="res_info">
            </div>
        </div>
    </div>
</body>
<script>
    var clearAlarm = function () {
        var mask_tags = document.getElementsByClassName("display_info")
        for (let mt of mask_tags) {
            mt.style.display = "none";
        }
    }

    var formSubmit = function () {
        document.getElementById("myForm").submit()
    }

    var submitDATA = function () {
        let student_id = document.getElementById("_id").value
        console.log(student_id)
        if (student_id) {
            axios.post("/checkDocx", {s_id: student_id})
                .then(function(res){
                    document.getElementsByClassName("main")[0].style.display = "block";
                    var resData = res.data;
                    var res_info = document.getElementById("res_info");
                    var buttons = document.getElementById("buttons");

                    res_info.style.display = "inline";
                    res_info.innerHTML = resData;
                    if (resData.indexOf("<table") >= 0){ // 如果查询到结果
                        buttons.style.display = "inline";
                    }
                })
                .catch(function(err){
                    console.log(err);
                })
        } else {
            console.log("帐号为空!")
        }
    }

    var printMe = function (){
        var oldBody = document.body.innerHTML;
        document.body.innerHTML = "<h2>上海对外经贸大学学生第二课堂经历证明</h2>" + document.getElementById('res_info').innerHTML;
        window.print();
        document.body.innerHTML = oldBody // 恢复
    }
</script>
</html>

 {% comment %} onclick="submitDATA()" {% endcomment %}